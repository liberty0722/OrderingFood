<!-- pages/index/index.wxml -->
<view class="page-container">
  <!-- é¡¶éƒ¨æœç´¢åŒºåŸŸ -->
  <view class="search-bar">
    <view class="search-input-wrap">
      <text class="search-icon">ğŸ”</text>
      <text class="search-placeholder">æœç´¢èœå“</text>
    </view>
  </view>

  <!-- ä¸»ä½“å†…å®¹åŒº -->
  <view class="main-content">
    <!-- å·¦ä¾§åˆ†ç±»æ  -->
    <scroll-view class="category-list" scroll-y enhanced show-scrollbar="{{false}}">
      <view
        wx:for="{{categories}}"
        wx:key="id"
        class="category-item {{currentCategoryId === item.id ? 'active' : ''}}"
        data-id="{{item.id}}"
        bindtap="onCategoryTap"
      >
        <text class="category-icon">{{item.icon}}</text>
        <text class="category-name">{{item.name}}</text>
      </view>
      <!-- å·¦ä¾§åˆ†ç±»åº•éƒ¨ç•™ç™½ï¼Œé˜²æ­¢è¢«è´­ç‰©è½¦æ é®æŒ¡ -->
      <view class="category-bottom-space"></view>
    </scroll-view>

    <!-- å³ä¾§èœå“åˆ—è¡¨ -->
    <scroll-view class="menu-list" scroll-y enhanced show-scrollbar="{{false}}">
      <view class="menu-category-title">
        <text>{{currentCategoryIcon}} {{currentCategoryName}}</text>
      </view>
      <view
        wx:for="{{filteredMenu}}"
        wx:key="id"
        class="menu-item"
      >
        <!-- èœå“å›¾ç‰‡å ä½ -->
        <view class="menu-item-img">
          <text class="menu-item-emoji">ğŸ½ï¸</text>
        </view>
        <!-- èœå“ä¿¡æ¯ -->
        <view class="menu-item-info">
          <text class="menu-item-name">{{item.name}}</text>
          <text class="menu-item-desc">{{item.description}}</text>
          <view class="menu-item-bottom">
            <view class="menu-item-price">
              <text class="price-symbol">Â¥</text>
              <text class="price-value">{{item.price}}</text>
            </view>
            <view class="menu-item-sales">æœˆå”®{{item.sales}}</view>
          </view>
          <!-- åŠ å‡æŒ‰é’® -->
          <view class="cart-controls">
            <view wx:if="{{item.count > 0}}" class="reduce-btn" data-id="{{item.id}}" catchtap="onReduceItem">
              <text>âˆ’</text>
            </view>
            <text wx:if="{{item.count > 0}}" class="item-count">{{item.count}}</text>
            <view class="add-btn" data-item="{{item}}" catchtap="onAddItem">
              <text>+</text>
            </view>
          </view>
        </view>
      </view>

      <!-- åˆ—è¡¨åº•éƒ¨ç•™ç™½ -->
      <view class="list-bottom-space"></view>
    </scroll-view>
  </view>

  <!-- è‡ªåˆ›èœå“æ‚¬æµ®æŒ‰é’®åŒºåŸŸ -->
  <view class="custom-dish-float-area">
    <view class="custom-dish-float-btn" bindtap="onShowCustomDish">
      <text class="custom-dish-float-icon">âœï¸</text>
      <text class="custom-dish-float-text">æƒ³åƒä»€ä¹ˆ</text>
    </view>
    <view class="custom-dish-suggestion-btn" bindtap="onShowSuggestionList">
      <text class="custom-dish-float-icon">ğŸ“‹</text>
      <text class="custom-dish-float-text">æˆ‘çš„å»ºè®®</text>
    </view>
  </view>

  <!-- åº•éƒ¨è´­ç‰©è½¦æ  -->
  <view class="cart-bar">
    <view class="cart-bar-left" bindtap="onToggleCartPopup">
      <view class="cart-icon-wrap">
        <text class="cart-icon">ğŸ›’</text>
        <view wx:if="{{cartTotalCount > 0}}" class="cart-badge">{{cartTotalCount}}</view>
      </view>
      <view class="cart-price-info">
        <text wx:if="{{cartTotalCount > 0}}" class="cart-total-price">Â¥{{cartTotalPrice}}</text>
        <text wx:else class="cart-empty-text">æœªé€‰è´­å•†å“</text>
      </view>
    </view>
    <view
      class="cart-checkout-btn {{cartTotalCount > 0 ? 'active' : ''}}"
      bindtap="onGoCheckout"
    >
      å»ç»“ç®—
    </view>
  </view>

  <!-- è‡ªå®šä¹‰èœå“å¼¹çª— - æäº¤å»ºè®®ç»™å•†å®¶ -->
  <view wx:if="{{showCustomDishPopup}}" class="custom-dish-mask" bindtap="onHideCustomDish">
    <view class="custom-dish-popup" catchtap="onStopPropagation">
      <view class="custom-dish-header">
        <text class="custom-dish-title">âœï¸ æƒ³åƒä»€ä¹ˆï¼Ÿå‘Šè¯‰å•†å®¶ï¼</text>
        <text class="custom-dish-subtitle">æäº¤åå•†å®¶ä¼šæ”¶åˆ°é€šçŸ¥ï¼Œé‡‡çº³åå°†ä¸Šæ¶åˆ°èœå•</text>
      </view>
      <view class="custom-dish-form">
        <view class="custom-dish-field">
          <text class="field-label">èœå“åç§° *</text>
          <input
            class="field-input"
            placeholder="è¯·è¾“å…¥ä½ æƒ³åƒçš„èœå“åç§°"
            value="{{customDishName}}"
            bindinput="onCustomDishNameInput"
          />
        </view>
        <view class="custom-dish-field">
          <text class="field-label">è¡¥å……è¯´æ˜</text>
          <input
            class="field-input"
            placeholder="å£å‘³ã€åšæ³•ç­‰è¦æ±‚ï¼ˆé€‰å¡«ï¼‰"
            value="{{customDishDesc}}"
            bindinput="onCustomDishDescInput"
          />
        </view>
      </view>
      <view class="custom-dish-actions">
        <view class="custom-dish-cancel" bindtap="onHideCustomDish">å–æ¶ˆ</view>
        <view class="custom-dish-confirm" bindtap="onConfirmCustomDish">æäº¤ç»™å•†å®¶</view>
      </view>
    </view>
  </view>

  <!-- æˆ‘çš„èœå“å»ºè®®åˆ—è¡¨å¼¹çª— -->
  <view wx:if="{{showSuggestionList}}" class="custom-dish-mask" bindtap="onHideSuggestionList">
    <view class="suggestion-list-popup" catchtap="onStopPropagation">
      <view class="suggestion-list-header">
        <text class="suggestion-list-title">ğŸ“‹ æˆ‘çš„èœå“å»ºè®®</text>
        <text class="suggestion-list-close" bindtap="onHideSuggestionList">âœ•</text>
      </view>
      <scroll-view class="suggestion-list-scroll" scroll-y enhanced show-scrollbar="{{false}}">
        <view wx:if="{{suggestionList.length === 0}}" class="suggestion-empty">
          <text class="suggestion-empty-icon">ğŸ’¡</text>
          <text class="suggestion-empty-text">è¿˜æ²¡æœ‰æäº¤è¿‡å»ºè®®å“¦</text>
        </view>
        <view wx:for="{{suggestionList}}" wx:key="_id" class="suggestion-item">
          <view class="suggestion-item-top">
            <text class="suggestion-item-name">{{item.name}}</text>
            <text class="suggestion-status suggestion-status-{{item.status === 'å¾…å®¡æ ¸' ? 'pending' : item.status === 'å·²ä¸Šæ¶' ? 'approved' : 'rejected'}}">{{item.status}}</text>
          </view>
          <view wx:if="{{item.description}}" class="suggestion-item-desc">
            <text>{{item.description}}</text>
          </view>
          <view class="suggestion-item-time">
            <text>{{item.createTimeStr}}</text>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- è´­ç‰©è½¦å¼¹çª— -->
  <view wx:if="{{showCartPopup}}" class="cart-popup-mask" bindtap="onHideCartPopup">
    <view class="cart-popup" catchtap="onStopPropagation">
      <view class="cart-popup-header">
        <text class="cart-popup-title">å·²é€‰å•†å“</text>
        <view class="cart-popup-clear" bindtap="onClearCart">
          <text>ğŸ—‘ï¸ æ¸…ç©º</text>
        </view>
      </view>
      <scroll-view class="cart-popup-list" scroll-y enhanced show-scrollbar="{{false}}">
        <view wx:for="{{cart}}" wx:key="id" class="cart-popup-item">
          <view class="cart-popup-item-info">
            <text class="cart-popup-item-name">{{item.name}}</text>
          </view>
          <view class="cart-popup-item-right">
            <text class="cart-popup-item-price">Â¥{{item.price}}</text>
            <view class="cart-popup-item-controls">
              <view class="reduce-btn" data-id="{{item.id}}" catchtap="onPopupReduceItem">
                <text>âˆ’</text>
              </view>
              <text class="item-count">{{item.count}}</text>
              <view class="add-btn" data-item="{{item}}" catchtap="onPopupAddItem">
                <text>+</text>
              </view>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
</view>
