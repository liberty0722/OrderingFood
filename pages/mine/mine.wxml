<!-- pages/mine/mine.wxml -->
<view class="mine-page">
  <!-- æœªç™»å½•çŠ¶æ€ -->
  <view wx:if="{{!isLoggedIn}}" class="not-login">
    <view class="not-login-icon">ğŸ‘¤</view>
    <view class="not-login-text">æœªç™»å½•</view>
    <view class="not-login-desc">ç™»å½•åæŸ¥çœ‹è®¢å•å’Œå†å²è®°å½•</view>
    <view class="login-btns">
      <button class="btn customer-btn" bindtap="onLogin">é¡¾å®¢ç™»å½•</button>
      <button class="btn merchant-btn" bindtap="onMerchantLogin">å•†å®¶ç™»å½•</button>
    </view>
  </view>

  <!-- å·²ç™»å½•çŠ¶æ€ -->
  <view wx:else class="login-state">
    <!-- ç”¨æˆ·å¤´åƒåŒºåŸŸ -->
    <view class="user-header">
      <view class="user-avatar">
        <image wx:if="{{userInfo.avatarUrl}}" class="avatar-image" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
        <text wx:else class="avatar-emoji">{{userRole === 'merchant' ? 'ğŸ‘¨â€ğŸ³' : 'ğŸ˜Š'}}</text>
      </view>
      <view class="user-info">
        <text class="user-name">{{userInfo.nickName || userInfo.merchantName}}</text>
        <text class="user-desc">{{userRole === 'merchant' ? 'å•†å®¶ç®¡ç†åå°' : 'æ¬¢è¿ä½¿ç”¨ç¾å‘³ç‚¹é¤'}}</text>
      </view>
      <view class="logout-btn" bindtap="onLogout">é€€å‡º</view>
    </view>

  <!-- åŠŸèƒ½å…¥å£ -->
  <view class="func-grid">
    <view class="func-item" bindtap="onGoOrder">
      <text class="func-icon">ğŸ½ï¸</text>
      <text class="func-text">å»ç‚¹é¤</text>
    </view>
    <view class="func-item" bindtap="onRefresh">
      <text class="func-icon">ğŸ”„</text>
      <text class="func-text">åˆ·æ–°è®¢å•</text>
    </view>
    <view wx:if="{{userRole === 'merchant'}}" class="func-item" bindtap="onGoMerchant">
      <text class="func-icon">ğŸ“Š</text>
      <text class="func-text">å•†å®¶ç®¡ç†</text>
    </view>
    <view class="func-item">
      <text class="func-icon">ğŸ“</text>
      <text class="func-text">è”ç³»å®¢æœ</text>
    </view>
  </view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <view class="order-section">
    <view class="order-section-title">
      <text class="order-section-title-text">{{userRole === 'merchant' ? 'æ‰€æœ‰è®¢å•' : 'æˆ‘çš„è®¢å•'}}</text>
    </view>

    <!-- åŠ è½½ä¸­ -->
    <view wx:if="{{loading}}" class="empty-state" style="padding: 80rpx 0;">
      <text class="empty-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- ç©ºè®¢å• -->
    <view wx:elif="{{orders.length === 0}}" class="empty-state" style="padding: 80rpx 0;">
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-text">æš‚æ— è®¢å•</text>
      <view class="go-order-btn" bindtap="onGoOrder">å»ç‚¹é¤</view>
    </view>

    <!-- è®¢å•åˆ—è¡¨ -->
    <view wx:else class="order-list">
      <view
        wx:for="{{orders}}"
        wx:key="_id"
        class="order-card"
        data-id="{{item._id}}"
        bindtap="onOrderTap"
      >
        <view class="order-card-header">
          <text class="order-id">{{item.orderId}}</text>
          <text class="order-status">{{item.status}}</text>
        </view>
        <view class="order-card-body">
          <view class="order-card-items">
            <text wx:for="{{item.items}}" wx:for-item="food" wx:key="id" class="order-food-name">
              {{food.name}} x{{food.count}}{{index < item.items.length - 1 ? 'ã€' : ''}}
            </text>
          </view>
          <view class="order-card-info">
            <text class="order-table">æ¡Œå·ï¼š{{item.tableNo}}</text>
            <text class="order-time">{{item.createTimeStr}}</text>
          </view>
        </view>
        <view class="order-card-footer">
          <text class="order-total">åˆè®¡ï¼š<text class="order-price">Â¥{{item.totalPrice}}</text></text>
        </view>
      </view>
    </view>
  </view>
  </view>
</view>
